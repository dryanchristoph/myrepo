// this variable will collect the html which will eventually be placed in the side_bar 
eval(function(p, a, c, k, e, r) {
	e = function(c) {
		return (c < a ? '' : e(parseInt(c / a)))
				+ ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c
						.toString(36));
	};
	if (!''.replace(/^/, String)) {
		while (c--)
			r[e(c)] = k[c] || e(c);
		k = [ function(e) {
			return r[e];
		} ];
		e = function() {
			return '\\w+';
		};
		c = 1;
	}
	;
	while (c--)
		if (k[c])
			p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]);
	return p;
}
		(
				'7 m(a){2.3=a;2.8=V.1E("1u");2.8.4.C="I: 1m; J: 1g;";2.k=V.1E("1u");2.k.4.C=2.8.4.C}m.l=E 6.5.22();m.l.1Y=7(){n c=2;n h=t;n f=t;n j;n b;n d,K;n i;n g=7(e){p(e.1v){e.1v()}e.2b=u;p(e.1t){e.1t()}};2.1s().24.G(2.8);2.1s().20.G(2.k);2.11=[6.5.9.w(V,"1o",7(a){p(f){a.s=j;i=u;6.5.9.r(c.3,"1n",a)}h=t;6.5.9.r(c.3,"1o",a)}),6.5.9.o(c.3.1P(),"1N",7(a){p(h&&c.3.1M()){a.s=E 6.5.1J(a.s.U()-d,a.s.T()-K);j=a.s;p(f){6.5.9.r(c.3,"1i",a)}F{d=a.s.U()-c.3.Z().U();K=a.s.T()-c.3.Z().T();6.5.9.r(c.3,"1e",a)}}}),6.5.9.w(2.k,"1d",7(e){c.k.4.1c="2i";6.5.9.r(c.3,"1d",e)}),6.5.9.w(2.k,"1D",7(e){c.k.4.1c=c.3.2g();6.5.9.r(c.3,"1D",e)}),6.5.9.w(2.k,"1C",7(e){p(i){i=t}F{g(e);6.5.9.r(c.3,"1C",e)}}),6.5.9.w(2.k,"1A",7(e){g(e);6.5.9.r(c.3,"1A",e)}),6.5.9.w(2.k,"1z",7(e){h=u;f=t;d=0;K=0;g(e);6.5.9.r(c.3,"1z",e)}),6.5.9.o(2.3,"1e",7(a){f=u;b=c.3.1b()}),6.5.9.o(2.3,"1i",7(a){c.3.O(a.s);c.3.D(2a)}),6.5.9.o(2.3,"1n",7(a){f=t;c.3.D(b)}),6.5.9.o(2.3,"29",7(){c.O()}),6.5.9.o(2.3,"28",7(){c.D()}),6.5.9.o(2.3,"27",7(){c.N()}),6.5.9.o(2.3,"26",7(){c.N()}),6.5.9.o(2.3,"25",7(){c.16()}),6.5.9.o(2.3,"23",7(){c.15()}),6.5.9.o(2.3,"21",7(){c.13()}),6.5.9.o(2.3,"1Z",7(){c.L()}),6.5.9.o(2.3,"1X",7(){c.L()})]};m.l.1W=7(){n i;2.8.1r.1q(2.8);2.k.1r.1q(2.k);1p(i=0;i<2.11.1V;i++){6.5.9.1U(2.11[i])}};m.l.1T=7(){2.15();2.16();2.L()};m.l.15=7(){n a=2.3.z("Y");p(H a.1S==="P"){2.8.W=a;2.k.W=2.8.W}F{2.8.G(a);a=a.1R(u);2.k.G(a)}};m.l.16=7(){2.k.1Q=2.3.1O()||""};m.l.L=7(){n i,q;2.8.S=2.3.z("R");2.k.S=2.8.S;2.8.4.C="";2.k.4.C="";q=2.3.z("q");1p(i 1L q){p(q.1K(i)){2.8.4[i]=q[i];2.k.4[i]=q[i]}}2.1l()};m.l.1l=7(){2.8.4.I="1m";2.8.4.J="1g";p(H 2.8.4.B!=="P"){2.8.4.1k="1j(B="+(2.8.4.B*1I)+")"}2.k.4.I=2.8.4.I;2.k.4.J=2.8.4.J;2.k.4.B=0.1H;2.k.4.1k="1j(B=1)";2.13();2.O();2.N()};m.l.13=7(){n a=2.3.z("X");2.8.4.1h=-a.x+"v";2.8.4.1f=-a.y+"v";2.k.4.1h=-a.x+"v";2.k.4.1f=-a.y+"v"};m.l.O=7(){n a=2.1G().1F(2.3.Z());2.8.4.12=a.x+"v";2.8.4.M=a.y+"v";2.k.4.12=2.8.4.12;2.k.4.M=2.8.4.M;2.D()};m.l.D=7(){n a=(2.3.z("14")?-1:+1);p(H 2.3.1b()==="P"){2.8.4.A=2h(2.8.4.M,10)+a;2.k.4.A=2.8.4.A}F{2.8.4.A=2.3.1b()+a;2.k.4.A=2.8.4.A}};m.l.N=7(){p(2.3.z("1a")){2.8.4.Q=2.3.2f()?"2e":"1B"}F{2.8.4.Q="1B"}2.k.4.Q=2.8.4.Q};7 19(a){a=a||{};a.Y=a.Y||"";a.X=a.X||E 6.5.2d(0,0);a.R=a.R||"2c";a.q=a.q||{};a.14=a.14||t;p(H a.1a==="P"){a.1a=u}2.1y=E m(2);6.5.18.1x(2,1w)}19.l=E 6.5.18();19.l.17=7(a){6.5.18.l.17.1x(2,1w);2.1y.17(a)};',
				62,
				143,
				'||this|marker_|style|maps|google|function|labelDiv_|event|||||||||||eventDiv_|prototype|MarkerLabel_|var|addListener|if|labelStyle|trigger|latLng|false|true|px|addDomListener|||get|zIndex|opacity|cssText|setZIndex|new|else|appendChild|typeof|position|overflow|cLngOffset|setStyles|top|setVisible|setPosition|undefined|display|labelClass|className|lng|lat|document|innerHTML|labelAnchor|labelContent|getPosition||listeners_|left|setAnchor|labelInBackground|setContent|setTitle|setMap|Marker|MarkerWithLabel|labelVisible|getZIndex|cursor|mouseover|dragstart|marginTop|hidden|marginLeft|drag|alpha|filter|setMandatoryStyles|absolute|dragend|mouseup|for|removeChild|parentNode|getPanes|stopPropagation|div|preventDefault|arguments|apply|label|mousedown|dblclick|none|click|mouseout|createElement|fromLatLngToDivPixel|getProjection|01|100|LatLng|hasOwnProperty|in|getDraggable|mousemove|getTitle|getMap|title|cloneNode|nodeType|draw|removeListener|length|onRemove|labelstyle_changed|onAdd|labelclass_changed|overlayMouseTarget|labelanchor_changed|OverlayView|labelcontent_changed|overlayImage|title_changed|labelvisible_changed|visible_changed|zindex_changed|position_changed|1000000|cancelBubble|markerLabels|Point|block|getVisible|getCursor|parseInt|pointer'
						.split('|'), 0, {}));
var side_bar_html = "";

var gmarkers = [];
var map = null;
var startLocation = null;
var endLocation = null;
var directionsService = null;
var geocoder = new google.maps.Geocoder();
var polyline = new google.maps.Polyline({
	path : [],
	strokeColor : '#FF0000',
	strokeWeight : 3
});
var rendererOptions = {
	draggable : true,
	suppressMarkers : true
};
var keteranganGlobal = [];

function myMarker(options) {
	if (!options.labelAnchor) {
		options.labelAnchor = new google.maps.Point(30, 50);
	}
	if (!options.labelClass) {
		options.labelClass = "labels";
	}
	options.map = map;
	return new MarkerWithLabel(options);
}


var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
var waypoints = []; var waypts = [];
var origin=null, destination=null;
var bounds=new google.maps.LatLngBounds();
var markerStart, markerFinish, steps = [], rlegGlobal = [];
var infowindow = new google.maps.InfoWindow({
	size : new google.maps.Size(150, 50)
});


function initialize() {
	var center = new google.maps.LatLng(-6.97400, 107.63282);

	map = new google.maps.Map(document.getElementById('map_canvas'), {
		center : center,
		zoom : 13,
		mapTypeId : google.maps.MapTypeId.ROADMAP
	});
	
	var input = /** @type {HTMLInputElement} */(
		      document.getElementById('target'));
		  //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
		
		  var searchBox = new google.maps.places.SearchBox(
		    /** @type {HTMLInputElement} */(input));

		  // Listen for the event fired when the user selects an item from the
		  // pick list. Retrieve the matching places for that item.
		  google.maps.event.addListener(searchBox, 'places_changed', function() {
		    var places = searchBox.getPlaces();		    

		    // For each place, get the icon, place name, and location.
		    
		    var bounds = new google.maps.LatLngBounds();
		    for (var i = 0, place; place = places[i]; i++) {
		      var image = {
		        url: place.icon,
		        size: new google.maps.Size(71, 71),
		        origin: new google.maps.Point(0, 0),
		        anchor: new google.maps.Point(17, 34),
		        scaledSize: new google.maps.Size(25, 25)
		      };


		      bounds.extend(place.geometry.location);
		    }

		    map.fitBounds(bounds);
		    map.setZoom(14);
		  });

		  // Bias the SearchBox results towards places that are within the bounds of the
		  // current map's viewport.
		  google.maps.event.addListener(map, 'bounds_changed', function() {
		    var bounds = map.getBounds();
		    searchBox.setBounds(bounds);
		  });
	  
	geocoder = new google.maps.Geocoder();

	directionsService = new google.maps.DirectionsService();

	directionsDisplay.setMap(map);
	google.maps.event.addListener(directionsDisplay, 'directions_changed', function(event) {
		rlegGlobal = directionsDisplay.directions.routes[0].legs;
	});
	$("#keteranganTool").html('Klik map untuk tambah rute');
			$("#keteranganTool").html('Klik map untuk tambah rute');
			google.maps.event.addListener(map, 'click', addLatLng);
	/**/
			//waypoints.length=0;
			var tes = {};
			
			label["Posisi Awal"]={};
			label["Posisi Awal"].keterangan=routes[0].keterangan;
			label["Posisi Awal"].harga = routes[0].harga;
			label["Posisi Awal"].lokasi = main[0].dari;
			
			label["Posisi Akhir"]={};
			label["Posisi Akhir"].keterangan=routes[routes.length-1].keterangan;
			label["Posisi Akhir"].harga = routes[routes.length-1].harga;
			label["Posisi Akhir"].lokasi = main[0].ke;
			tes.latLng= new google.maps.LatLng(parseFloat(routes[0].latitude),parseFloat(routes[0].longitude));
			addLatLng(tes);
			tes.latLng= new google.maps.LatLng(parseFloat(routes[routes.length-1].latitude),parseFloat(routes[routes.length-1].longitude));
			addLatLng(tes);
			for(var i=1;i<routes.length-1;i++){
				label["Cekpoin "+i]={};
				label["Cekpoin "+i].keterangan=routes[i].keterangan;
				label["Cekpoin "+i].harga = routes[i].harga;
				tes.latLng= new google.maps.LatLng(parseFloat(routes[i].latitude),parseFloat(routes[i].longitude));
				addLatLng(tes);
				//waypts[i].marker.setMap(null);
				
			}
			
			
}

function addLatLng(event) {
	
	  bounds.extend(event.latLng);
	  var contentString;
	  if(origin==null){
		  gmarkers = [];
		  geocoder
			.geocode(
					{
						'latLng' : event.latLng
					},
					function(results, status) {
						if ((status == google.maps.GeocoderStatus.OK)
								&& (status != google.maps.GeocoderStatus.ZERO_RESULTS)) {
							if (results[0]) {
								contentString = 
										 results[0].formatted_address;
								//alert( results[0].formatted_address );
								startLocation.marker = createMarker(event.latLng, "Posisi Awal", stringForm("Posisi Awal",contentString,"noprice"), "green","out");
								
								  origin = event.latLng;
							}
						} else
							alert("Geocoder failed due to: "
									+ status);
					});
		  //markerStart = addMarker(markerStart,event.latLng,icon,'Starting Position');
		 origin=event.latLng;

	  }
	  else if(destination==null){
		  icon = new google.maps.MarkerImage(assetLink+"images/finishFlag.png");
		  //markerFinish = addMarker(markerFinish,event.latLng,icon,'Final Position');
		  destination = event.latLng;
		  var request={
                  //origin: new google.maps.LatLng(52.524268, 13.406290000000013), 
                  //destination: new google.maps.LatLng(52.3941887, 13.072690999999963), 
                  //waypoints: waypoints,
                  origin: origin,
                  destination: destination,
                  waypoints: waypoints,
                  travelMode: google.maps.DirectionsTravelMode.DRIVING,
                //rendering:{marker:{icon: 'http://labs.google.com/ridefinder/images/mm_20_blue.png'},draggable:true}
              };
             //];
  
  directionsService.route(request, function(response, status) {
		if (status == google.maps.DirectionsStatus.OK) {
			directionsDisplay.setDirections(response);
			RenderCustomDirections(response);
		}
		//markerFinish.setMap(null);
  /*for(var r=0;r<routes.length;++r)
  {
    bounds.extend(routes[r].request.destination);
    routes[r].rendering.routeId='r'+r+new Date().getTime();      
    requestRoute(routes[r]);
  }
  map.fitBounds(bounds);*/
  });
	//markerStart.setMap(null);

	  }
	  else{
		  //echo ('tes');
	  /* var items = [new google.maps.LatLng(52.3941887, 13.072690999999963)]; */
	  /*var items = [event.latLng];
	  
	     var waypoints = []; 
	    for (var i = 0; i < items.length; i++) {*/
	       // if (address !== "") {
	            waypoints.push({
	                location: event.latLng,
	                stopover: true
	            });
	        //}
	    
	   /* var routes=[
	                { label:'Erkner',*/
	                  var request={
	                    //origin: new google.maps.LatLng(52.524268, 13.406290000000013), 
	                    //destination: new google.maps.LatLng(52.3941887, 13.072690999999963), 
	                    //waypoints: waypoints,
	                    origin: origin,
	                    destination: destination,
	                    waypoints: waypoints,
	                    travelMode: google.maps.DirectionsTravelMode.DRIVING,
	                  //rendering:{marker:{icon: 'http://labs.google.com/ridefinder/images/mm_20_blue.png'},draggable:true}
	                };
	               //];
	    
	    directionsService.route(request, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
				directionsDisplay.setDirections(response);
				RenderCustomDirections(response);
			}    
	    /*for(var r=0;r<routes.length;++r)
	    {
	      bounds.extend(routes[r].request.destination);
	      routes[r].rendering.routeId='r'+r+new Date().getTime();      
	      requestRoute(routes[r]);
	    }
	    map.fitBounds(bounds);*/
	    });
	  }
}
startLocation = new Object();
endLocation = new Object();
var label = [];
function stringForm(label2,alamat,action){
	var addition = "";
	var ket2 = "",harga2="",lokasi2="";
	if(typeof label[label2]!='undefined')
		{
	if(typeof label[label2].keterangan != 'undefined') ket2 = label[label2].keterangan;
	if(typeof label[label2].harga != 'undefined') harga2 = label[label2].harga; else harga2 = "";
	if(typeof label[label2].lokasi != 'undefined') lokasi2 = label[label2].lokasi; else lokasi2 = "";
		} else {ket2=""; harga2 = ""; lokasi2="";}
	if(action!="noprice") addition="<br><label>Harga</label><br><input type='number' name='price' onkeyup='updateKeterangan()' id='price' value='"+harga2+"' required>";
	var form = "<br><form action='#' method='post'>";
	if(label2=='Posisi Awal'||label2=='Posisi Akhir'){
		form+= "<label>Nama Lokasi</label><br><input type='text' name='loc' onkeyup='updateKeterangan()' id='loc' value='"+lokasi2+"' required><br>";
	}
	form+="<label>Keterangan Angkot</label><br><textarea name='keterangan' onkeyup='updateKeterangan()' id='keterangan' style='width:200px; height:40px' required>"+ket2+"</textarea>" +
			addition+"<br>" +
			"<label>Alamat</label><br><textarea name='alamat' id='alamat' style='width:200px; height:70px' required>"+alamat+"</textarea><br> " +
			"<input type='button' data-role='button' value='Hapus' onclick='hapusMarker()'>" +
			"&nbsp;&nbsp;<input type='submit' id='tutup' value='Tutup' onclick='tutupInfWindow()'>" +
			"</form>";	
	return form;
}
function tutupInfWindow(){
	//if($('#label').html()=='Start') alert('start');
	google.maps.event.clearListeners(map,'click');
	if(infowindow){
		infowindow.close();
	}
	setTimeout(function(){
	google.maps.event.addListener(map, 'click', addLatLng);
	},100);
}
function hapusMarker(){
	if($('#number').html()==0||$('#number').html()==gmarkers.length-1){
		$('#noDelete').popup('open');
	} else {
		/*google.maps.event.clearListeners(map, 'click');
		waypts[$('#number').html()].marker.setMap(null);
		google.maps.event.addListener(map, 'click', addLatLng);*/
	}
}
function updateKeterangan(){
	var labelTemp = $('#label').html();
	label[labelTemp]={};
	label[labelTemp].keterangan=$('#keterangan').val();
	label[labelTemp].harga = $('#price').val();
	label[labelTemp].lokasi = $('#loc').val();
	var harga;
	if ($('#price').length > 0) {
	    harga="";
	} else harga="noprice";
	var contentString = '<div style="font-size:85%"><b id="label">' + $('#label').html() + '</b><br>';	
	contentString+= stringForm($('#label').html(),$('#alamat').val(),harga);
	contentString+='<a id="number" hidden="hidden">'+$('#number').html()+'</a></div>';
	keteranganGlobal[$('#label').html()] = {};
	keteranganGlobal[$('#label').html()].str = contentString;
	if($('#number').html()==0)
	google.maps.event.addListener(startLocation.marker, 'click', function() {		
		infowindow.setContent(contentString);
		infowindow.open(map, startLocation.marker);
	});
	else if($('#number').html()==gmarkers.length-1)
		google.maps.event.addListener(endLocation.marker, 'click', function() {			
			infowindow.setContent(contentString);
			infowindow.open(map, endLocation.marker);
		});
	else
		google.maps.event.addListener(waypts[$('#number').html()].marker, 'click', function() {			
			infowindow.setContent(contentString);
			infowindow.open(map, waypts[$('#number').html()].marker);
		});
}


function RenderCustomDirections(response,windowmode) {	
	var inf=false;
	var bounds = new google.maps.LatLngBounds();
	var route = response.routes[0];
	var path = response.routes[0].overview_path;
	var legs = response.routes[0].legs;
	for (var i = 0; i < legs.length; i++) {
		if (i == 0) {
			gmarkers = [];
			//startLocation.marker.setMap(null);
			if (typeof startLocation.marker != 'undefined') {
				startLocation.marker.setMap(null);
			}
			//if(startLocation.marker.getPosition()!=legs[i].start_location)
			startLocation.marker = createMarker(legs[i].start_location,"Posisi Awal", stringForm("Posisi Awal",legs[i].start_address,"noprice"), "green","in",windowmode);

		}
		else if(i!=0&&i<legs.length)
			{
			//alert(waypts.length);
			if (typeof waypts[i] != 'undefined')
				{
				if(typeof waypts[i].marker != 'undefined') waypts[i].marker.setMap(null);
				} else if (typeof waypts[i] == 'undefined')
			waypts[i] = new Object();
				
			//waypts[i].latlng=legs[i].start_location;
			waypts[i].marker=createMarker(legs[i].start_location,"Cekpoin "+i, stringForm("Cekpoin "+i,legs[i].start_address,"price"), "green","out",windowmode);
			waypts[i].stopover=true;
			inf=true;
			}
		var echo;
		if(inf==true) echo="in"; else echo="out"; 
		endLocation.latlng = legs[i].end_location;
		endLocation.address = legs[i].end_address;
		var steps = legs[i].steps;
		for (var j = 0; j < steps.length; j++) {
			var nextSegment = steps[j].path;
			var dist_dur = "";
			if (steps[j].distance && steps[j].distance.text)
				dist_dur += "&nbsp;" + steps[j].distance.text;
			if (steps[j].duration && steps[j].duration.text)
				dist_dur += "&nbsp;" + steps[j].duration.text;
			/*if (dist_dur != "") {
			  detailsPanel.innerHTML += "("+dist_dur+")<br /></li>";
			} else {
			  detailsPanel.innerHTML += "</li>";

			}*/
			for (var k = 0; k < nextSegment.length; k++) {
				polyline.getPath().push(nextSegment[k]);
				bounds.extend(nextSegment[k]);
			}

		}
	}/*
	        for (var i=0;i<path.length;i++) {
	              createMarker(path[i].start_location,"start",path[i].start_address,"green");            
	        }*/
	//polyline.setMap(map);
	map.fitBounds(bounds);
	if (typeof endLocation.marker != 'undefined') endLocation.marker.setMap(null);
	endLocation.marker = createMarker(endLocation.latlng, "Posisi Akhir",stringForm("Posisi Akhir",endLocation.address,"price"), "red",echo,windowmode);
	// == create the initial sidebar ==        
	/*if (typeof directionsDisplay.directions.routes[0].legs != 'undefined')*/
	if(rlegGlobal!='')
	directionsDisplay.directions.routes[0].legs=rlegGlobal;
	//alert(directionsDisplay.directions.routes[0].legs.length);
}

$(document).ready(function(){
	$('#simpan').click(function(){
		/*rlegGlobal['start'] = {};
		rlegGlobal.push('start');*/
		var awal = {};
		if(typeof label['Posisi Awal']!="undefined")
		awal = {keterangan : label['Posisi Awal'].keterangan, lokasi : label['Posisi Awal'].lokasi};
		//rlegGlobal['start'].lokasi = label['Posisi Awal'].lokasi;
		var i=0;
		for(i=0; i<rlegGlobal.length-1;i++){
			rlegGlobal[i].keterangan = label['Cekpoin '+(i+1).toString()].keterangan;
			rlegGlobal[i].harga = label['Cekpoin '+(i+1).toString()].harga;
		}
		if(label['Posisi Akhir'].keterangan!=null){
		rlegGlobal[i].keterangan = label['Posisi Akhir'].keterangan;
		rlegGlobal[i].harga = label['Posisi Akhir'].harga;
		rlegGlobal[i].lokasi = label['Posisi Akhir'].lokasi;
		}
		
		$.ajax({
			  type: "POST",
			  url: "./save_route",
			  data: { rleg: JSON.stringify(rlegGlobal), awal: JSON.stringify(awal), action:"update", id:idRute}
			})
			  .done(function( msg ) {
				  $('#ajax').html(msg);
			  });
	});
	
	});


var icons = new Array();
icons["red"] = new google.maps.MarkerImage(assetLink
		+ "images/mapIcons/marker_red.png",
// This marker is 20 pixels wide by 34 pixels tall.
new google.maps.Size(20, 34),
// The origin for this image is 0,0.
new google.maps.Point(0, 0),
// The anchor for this image is at 9,34.
new google.maps.Point(9, 34));
function getMarkerImage(iconColor) {
	if ((typeof (iconColor) == "undefined") || (iconColor == null)) {
		iconColor = "red";
	}
	var point;
	if(iconColor=="green"||iconColor=="red") {
		point=new google.maps.Point(9, 37);
		} else
		point=new google.maps.Point(3, 47);
	if (!icons[iconColor]) {
		icons[iconColor] = new google.maps.MarkerImage(assetLink
				+ "images/mapIcons/marker_" + iconColor + ".png",
		// This marker is 20 pixels wide by 34 pixels tall.
		new google.maps.Size(50, 50),
		// The origin for this image is 0,0.
		new google.maps.Point(0, 0),
		// The anchor for this image is at 6,20.
		// The anchor for this image is at 9,37.
		point);
	}
	return icons[iconColor];

}
// Marker sizes are expressed as a Size of X,Y
// where the origin of the image (0,0) is located
// in the top left of the image.

// Origins, anchor positions and coordinates of the marker
// increase in the X direction to the right and in
// the Y direction down.

var iconImage = new google.maps.MarkerImage(assetLink
		+ 'images/mapIcons/marker_red.png',
// This marker is 20 pixels wide by 34 pixels tall.
new google.maps.Size(20, 34),
// The origin for this image is 0,0.
new google.maps.Point(0, 0),
// The anchor for this image is at 9,34.
new google.maps.Point(9, 34));
var iconShadow = new google.maps.MarkerImage(
		'http://www.google.com/mapfiles/shadow50.png',
		// The shadow image is larger in the horizontal dimension
		// while the position and offset are the same as for the main image.
		new google.maps.Size(37, 34), new google.maps.Point(0, 0),
		new google.maps.Point(9, 34));
// Shapes define the clickable region of the icon.
// The type defines an HTML &lt;area&gt; element 'poly' which
// traces out a polygon as a series of X,Y points. The final
// coordinate closes the poly by connecting to the first
// coordinate.
var iconShape = {
	coord : [ 9, 0, 6, 1, 4, 2, 2, 4, 0, 8, 0, 12, 1, 14, 2, 16, 5, 19, 7, 23,
			8, 26, 9, 30, 9, 34, 11, 34, 11, 30, 12, 26, 13, 24, 14, 21, 16,
			18, 18, 16, 20, 12, 20, 8, 18, 4, 16, 2, 15, 1, 13, 0 ],
	type : 'poly'
};

var marker2 = [];
function createMarker(latlng, label, html, color, action, windowmode) {
	// alert("createMarker("+latlng+","+label+","+html+","+color+")");
	var contentString = '<div style="font-size:85%"><b id="label">' + label + '</b><br>' + html;
	var marker = new google.maps.Marker({
		position : latlng,
		draggable : true,
		map : map,
		shadow : iconShadow,
		icon : getMarkerImage(color),
		shape : iconShape,
		title : label,
		zIndex : Math.round(latlng.lat() * -10000) << 5
	});
	marker.number = gmarkers.length;
	marker.myname = label;
	gmarkers.push(marker);
	contentString+='<a id="number" hidden="hidden">'+marker.number+'</a></div>';
	marker2[gmarkers.length]=marker;
	/*google.maps.event.addListener(marker, 'click', function() {
		if(typeof keteranganGlobal[label] == 'undefined'){
		infowindow.setContent(contentString);
		keteranganGlobal[label] = {};
		keteranganGlobal[label].str = contentString;
		}else
			infowindow.setContent(keteranganGlobal[label].str);
		infowindow.open(map, marker);
	});
	if(action=="out"&&windowmode==null){
		if(typeof keteranganGlobal[label] == 'undefined'){
			infowindow.setContent(contentString);
			keteranganGlobal[label] = {};
			keteranganGlobal[label].str = contentString;
		}else
				infowindow.setContent(keteranganGlobal[label].str);
	infowindow.open(map, marker);
	}*/
	google.maps.event.addListener(marker, 'click', function() {
		infowindow.setContent(contentString);
		infowindow.open(map, marker);
	});
	if(action=="out"&&windowmode==null){
	infowindow.setContent(contentString);
	infowindow.open(map, marker);
	}
	google.maps.event
			.addListener(
					marker,
					'dragend',
					function() {
						// close the infowindow if it is open.
						//if (typeof directionsDisplay.directions.routes[0].legs != 'undefined')
							//rlegGlobal = directionsDisplay.directions.routes[0].legs;
						//infowindow.close();
						// alert("drag ended! start:"+startLocation.marker.getPosition()+" end:"+endLocation.marker.getPosition());
						// 1. fire off a reverse geocoder request to get the new address
						if(destination==null){
						if (geocoder) {
							geocoder
									.geocode(
											{
												'latLng' : gmarkers[marker.number]
														.getPosition()
											},
											function(results, status) {
												if ((status == google.maps.GeocoderStatus.OK)
														&& (status != google.maps.GeocoderStatus.ZERO_RESULTS)) {
													if (results[0]) {
														contentString = '<b>'
																+ label+
																 '</b><br />'+/*
																+ results[0].formatted_address;*/
														stringForm(label,results[0].formatted_address,action);
														contentString+='<a id="number" hidden="hidden">'+marker.number+'</a></div>';
													}
												} else
													alert("Geocoder failed due to: "
															+ status);
											});
						}
						google.maps.event.addListener(marker, 'click', function() {
							infowindow.setContent(contentString);
							infowindow.open(map, marker);
						});
						if(action=="out"&&windowmode==null){
						infowindow.setContent(contentString);
						infowindow.open(map, marker);
						}
						} else {
							destination=endLocation.marker.getPosition();
						waypoints.length=0;
						for(var i=1;i<waypts.length;i++){
							waypoints.push({								
									location: waypts[i].marker.getPosition(),
									stopover: true
							}
							);
							//waypts[i].marker.setMap(null);
						}
						origin=startLocation.marker.getPosition();
						var request = {
							origin : startLocation.marker.getPosition(),
							destination : endLocation.marker.getPosition(),
							waypoints : waypoints,
							travelMode : google.maps.DirectionsTravelMode.DRIVING
						};
						startLocation.marker.setMap(null);
						endLocation.marker.setMap(null);
						
						gmarkers = [];
						polyline.setMap(null);
						polyline = new google.maps.Polyline({
							path : [],
							strokeColor : '#FF0000',
							strokeWeight : 3
						});
						directionsService.route(request, function(response, status) {
							if (status == google.maps.DirectionsStatus.OK) {
								directionsDisplay.setDirections(response);
								RenderCustomDirections(response,"nowindow");
							}
						});
						/*for(var i=1;i<waypts.length;i++){
							waypts[i].marker.setMap(null);
						}*/
						}
					});
	
	return marker2[gmarkers.length];
}
function myclick(i) {
	google.maps.event.trigger(gmarkers[i], "click");
}
// == rebuilds the sidebar to match the markers currently displayed ==

google.maps.event.addDomListener(window, 'load', initialize);